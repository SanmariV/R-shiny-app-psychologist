---
title: "xgboost"
author: "Sanmari Vivier"
date: "6/7/2020"
output: html_document
    theme: flatly
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    message = FALSE,
    warning = FALSE)
```

```{r}
library(tidyverse)
library(reticulate)
```
```{r}
# set conda environment
use_condaenv("py3.8", required = TRUE)

# check if the correct environment is being used
py_config()
```


```{python}
# is python working?
1+1
```


```{python}
# XGBoost algorithm--------------------------------------------
# import python libraries here
# in conda terminal (with py3.8 env activated, install xgboost): pip install xgboost
import xgboost as xgb
import sklearn
from sklearn.model_selection import train_test_split
import pandas as pd
import numpy as np
```


```{r}
# write tibble files to .csv files
female_dataset_py <- write_csv(female_dataset, 
                               path = "female_dataset_py.csv")
female_labels_py <- write_csv(female_labels,
                              path = "female_labels_py.csv")
males_dataset_py <- write_csv(males_dataset,
                              path = "males_dataset_py.csv")
males_labels_py <- write_csv(males_labels,
                             path = "males_labels_py.csv")
```


```{python}
# Import the created .csv files
# Females
data_female = pd.read_csv(r'C:/Users/Sanmari Vivier/Dropbox/Personal/r-shiny-app/r-markdown-files/female_dataset_py.csv')
data_female_labels = pd.read_csv(r'C:/Users/Sanmari Vivier/Dropbox/Personal/r-shiny-app/r-markdown-files/female_labels_py.csv')
female_dataset_py = pd.DataFrame(data_female)
female_labels_py = pd.DataFrame(data_female_labels)

# Check to see if it is working
print (female_dataset_py.head(), female_labels_py.head())
```


```{python}
# Import the created .csv files----------------------------------
# Males
data_male = pd.read_csv(r'C:/Users/Sanmari Vivier/Dropbox/Personal/r-shiny-app/r-markdown-files/males_dataset_py.csv')
data_male_labels = pd.read_csv(r'C:/Users/Sanmari Vivier/Dropbox/Personal/r-shiny-app/r-markdown-files/males_labels_py.csv')
male_dataset_py = pd.DataFrame(data_male)
male_labels_py = pd.DataFrame(data_male_labels)

# Check to see if it is working
print (male_dataset_py.head(), male_labels_py.head())
```


```{python}
# Split up the data into training and testing sets
# Females

females_data_train, females_data_test = train_test_split(female_dataset_py,
                 test_size=0.33, 
                 random_state=42)
females_labels_train, females_labels_test = train_test_split(female_labels_py,
                 test_size=0.33, 
                 random_state=42)
```
```{python}
# Split up the data into training and testing sets
# Males

males_data_train, males_data_test = train_test_split(male_dataset_py,
                 test_size=0.33, 
                 random_state=42)
males_labels_train, males_labels_test = train_test_split(male_labels_py,
                 test_size=0.33, 
                 random_state=42)

# Check if the data is split                 
print(males_labels_train)
```
# Model 1: XGBoost Classifier algorithm------------------------
```{python}
from xgboost import XGBClassifier
from sklearn.metrics import accuracy_score

# Train the model
model = XGBClassifier(max_depth=5,
                    eta=0.2,
                    gamma=4,
                    min_child_weight=6,
                    subsample=0.8,
                    #silent=0,
                    objective='reg:linear',
                    n_estimators=80,
                    seed=1729
                    )
                                        
model_xgb_f = model
model_xgb_m = model

model_xgb_f.fit(females_data_train, females_labels_train)
model_xgb_m.fit(males_data_train, males_labels_train)

# Test model
pred_xgb_f = model_xgb_f.predict(females_data_test)
pred_xgb_m = model_xgb_m.predict(males_data_test)
xgb_acc_f = accuracy_score(females_labels_test, pred_xgb_f)
xgb_acc_m = accuracy_score(males_labels_test, pred_xgb_m)
print("\n")
print("XGB model accuracy for females: {:.3f} %\n".format(xgb_acc_f * 100))
print("XGB model accuracy for males: {:.3f} %\n".format(xgb_acc_m * 100))
```

# Model 2: XGBoost Regressor algorithm------------------------
```{python}
# Model 2: XGB Regressor
# Here we will be calculating the loss using RMSE (root-mean-square-error)
from sklearn.metrics import mean_squared_error

model2 = xgb.XGBRegressor(objective='reg:squarederror', seed=1729)

# Train the model
model_xgbR_f = model2
model_xgbR_m = model2

model_xgbR_f.fit(females_data_train, females_labels_train, eval_metric='rmse')
model_xgbR_m.fit(males_data_train, males_labels_train, eval_metric='rmse')

# Test model
pred_xgbR_f = model_xgbR_f.predict(females_data_test)
pred_xgbR_m = model_xgbR_m.predict(males_data_test)
rmse_f = np.sqrt(mean_squared_error(females_labels_test, pred_xgbR_f))
rmse_m = np.sqrt(mean_squared_error(males_labels_test, pred_xgbR_m))
print("\n")
print("RMSE for females: {:.3f} \n".format(rmse_f))
print("RMSE for males: {:.3f} \n".format(rmse_m))

```

# Model 3: Naive Bayes algorithm------------------------
```{python}
from sklearn.naive_bayes import GaussianNB

# Change the data shapes for the labels using np.ravel()
# Train set
females_labels_train_nb = np.ravel(females_labels_train)
males_labels_train_nb = np.ravel(males_labels_train)

# Test set
females_labels_test_nb = np.ravel(females_labels_test)
males_labels_test_nb = np.ravel(males_labels_test)

model3 = GaussianNB()

# Train the model
model_nb_f = model3
model_nb_m = model3

model_nb_f.fit(females_data_train, females_labels_train_nb)
model_nb_m.fit(males_data_train, males_labels_train_nb)

# Test model
pred_nb_f = model_nb_f.predict(females_data_test)
pred_nb_m = model_nb_m.predict(males_data_test)
nb_acc_f = accuracy_score(females_labels_test_nb, pred_nb_f)
nb_acc_m = accuracy_score(males_labels_test_nb, pred_nb_m)
print("\n")
print("NB model accuracy for females: {:.3f} %\n".format(nb_acc_f * 100))
print("NB model accuracy for males: {:.3f} %\n".format(nb_acc_m * 100))
```

# Model 4: Support Vector Machine algorithm------------------
```{python}
from sklearn.svm import SVC

# Change the data shapes for the labels using np.ravel()
# Train set
females_labels_train_svm = np.ravel(females_labels_train)
males_labels_train_svm = np.ravel(males_labels_train)

# Test set
females_labels_test_svm = np.ravel(females_labels_test)
males_labels_test_svm = np.ravel(males_labels_test)

model4 = SVC(kernel="linear", gamma = 'auto', C = 10)

# Train the model
model_svm_f = model4
model_svm_m = model4

model_svm_f.fit(females_data_train, females_labels_train_svm)
model_svm_m.fit(males_data_train, males_labels_train_svm)

# Test model
pred_svm_f = model_svm_f.predict(females_data_test)
pred_svm_m = model_svm_m.predict(males_data_test)
svm_acc_f = accuracy_score(females_labels_test_svm, pred_svm_f)
svm_acc_m = accuracy_score(males_labels_test_svm, pred_svm_m)
print("\n")
print("SVM model accuracy for females: {:.3f} %\n".format(svm_acc_f * 100))
print("SVM model accuracy for males: {:.3f} %\n".format(svm_acc_m * 100))
```

